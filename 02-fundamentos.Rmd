# Fundamentos Descriptivos {#fundamentos}


```{r setup, include=FALSE}
# Instalar el paquete si no lo tienes


# Cargar el paquete
library(jsonlite)
library(paqueteMODELOS)
library(naniar)
library(mice)
library(xtable)
library(kableExtra)
library(corrplot)
library(openxlsx)
library(dplyr)
library(factoextra)
library(ca)
library(FactoMineR)
library(leaflet)
library(plotly)
library(ggplot2)
library(dplyr)
library(lmtest)
library(gridExtra)
library(DiagrammeR)
library(caret)
library(pROC)
library(tidyverse)
library(zoo)      # Para promedios móviles
library(lubridate)
library(ggplot2)
library(tsibble)  # Para manejo de series de tiempo
library(forecast) # Para descomposición
library(httr)
library(jsonlite)
library(readxl)
library(tseries)



# URL del archivo JSON
#url <- "https://www.datos.gov.co/resource/db67-sbus.json"

# Solicitar el contenido del JSON
#response <- GET(url)

# Convertir el contenido JSON a un dataframe y almacenarlo en 'datos'
#datos <- fromJSON(content(response, "text", encoding = "UTF-8"))



datos <- read_excel("data/datos.xlsx")


# Verificar los primeros registros
head(datos)

```


**Variables de la base de datos**

```{r warning=FALSE}
colnames(datos)
```

**3 primeros Registros de la base de datos** 

```{r warning=FALSE}
head(datos,3)
```
**número total de registros**

```{r warning=FALSE}
nrow(datos)
```


### EXPLORACION DE LOS DATOS

Se inicia con la exploracion del Dataset, asi como con el resumen estadistico

**Estructura del dataset**

```{r warning=FALSE}
# 
kable(head(datos), format = "markdown")

```


**Se realiza la verificación de valores nulos por cada una de las variables que conforman la data.**

```{r warning=FALSE}
# Verificar valores nulos
sum(is.na(datos))

# Verificar la cantidad de valores nulos por columna
colSums(is.na(datos))

grafico_faltantes <-md.pattern(datos, rotate.names = TRUE)

```


```{r warning=FALSE}
#Construcción de la serie temporal

df <- datos %>%
  mutate(
    numerocasos = as.numeric(numerocasos),
    numeropoblacionobjetivo = as.numeric(numeropoblacionobjetivo),
    tasa_suicidios = numerocasos / numeropoblacionobjetivo * 1000
  )


df <- df %>%
  mutate(tasa_suicidios = numerocasos / numeropoblacionobjetivo * 100000)


# Agrupar por año
serie_anual <- df %>%
  group_by(anio) %>%
  summarise(tasa_promedio = mean(tasa_suicidios, na.rm = TRUE))

# Verificar la serie
print(serie_anual)

suicidios_anuales <- datos %>%
  group_by(anio) %>%
  summarise(total_suicidios = sum(numerocasos, na.rm = TRUE))

ggplot(suicidios_anuales, aes(x = anio, y = total_suicidios)) +
  geom_line(color = "steelblue") +
  geom_point(color = "darkred") +
  labs(title = "Número anual de suicidios en Antioquia",
       x = "Año", y = "Total de suicidios")
```

## Promedio Móvil
```{r warning=FALSE}
#Promedio móvil
suicidios_anuales <- suicidios_anuales %>%
  mutate(promedio_movil = zoo::rollmean(total_suicidios, k = 3, fill = NA))

ggplot(suicidios_anuales, aes(x = anio)) +
  geom_line(aes(y = total_suicidios), color = "gray") +
  geom_line(aes(y = promedio_movil), color = "blue") +
  labs(title = "Promedio móvil de suicidios (k = 3)",
       y = "Número de suicidios")
```

## Rezagos y autocorrelación
```{r warning=FALSE}
ts_suicidios <- ts(suicidios_anuales$total_suicidios, start = min(suicidios_anuales$anio), frequency = 1)

# Autocorrelación
forecast::ggAcf(ts_suicidios) + ggtitle("Función de Autocorrelación (ACF)")

# Descomposición
# Si tuvieras frecuencia mensual: frequency = 12
#decomposicion <- decompose(ts_suicidios, type = "additive")
#plot(decomposicion)
```

## Estacionariedad y diferenciación
```{r warning=FALSE}
adf.test(ts_suicidios)  # Prueba de Dickey-Fuller aumentada

# Si no es estacionaria, aplicar diferenciación
ts_diff <- diff(ts_suicidios)

plot(ts_diff, main = "Serie diferenciada", ylab = "Diferencia de suicidios")
adf.test(ts_diff)  # Verificar estacionariedad después
```

## Transformación Box-Cox 
```{r warning=FALSE}


lambda <- BoxCox.lambda(ts_suicidios)
ts_boxcox <- BoxCox(ts_suicidios, lambda)

autoplot(ts_boxcox) + ggtitle("Serie transformada con Box-Cox")

```
